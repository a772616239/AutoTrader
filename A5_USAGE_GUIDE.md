# A5 多因子AI融合策略 - 使用指南

## 📋 概述

A5 是一个高级多因子 AI 融合策略，整合以下核心要素：
- **流动性因子** (25%): 成交量、流动性溢价、价格稳定性
- **基本面因子** (30%): P/E动量、盈利动量、股息信号
- **情绪因子** (20%): 社交情绪、供应链异常、技术信号
- **动量因子** (25%): RSI、MACD、ROC、趋势强度

## 🚀 启动方式

### 方式1: 命令行启动（推荐）

```bash
# 使用 A5 策略启动系统
python3 main.py --strategy a5

# 简写
python3 main.py -s a5
```

### 方式2: 在交互模式中切换

```bash
# 启动系统（默认使用 A1）
python3 main.py

# 在系统运行时，在控制台输入：
switch a5

# 查看帮助
help
```

### 方式3: 快速测试（测试日志输出）

```bash
# 运行单个周期测试脚本
python3 test_a5_logging.py
```

## 📊 日志说明

### 关键日志字段

运行 A5 策略后，你会看到以下日志：

#### 1. **因子评分日志** (INFO 级别)

每个因子单独输出其评分和计算过程：

```
[AAPL] A5流动性评分: 0.625 (成交量比=1.50, 趋势=0.75, 一致性=0.45)
[AAPL] A5基本面评分: 0.480 (PE动量=0.52, 盈利动量=0.48, 股息信号=0.43)
[AAPL] A5情绪评分: 0.520 (看涨信号=0.62, 成交量突增=0.55, 动量=0.38)
[AAPL] A5动量评分: 0.590 (RSI=0.62, MACD=0.58, ROC=0.52, 趋势=0.62)
```

#### 2. **AI 合成评分日志** (INFO 级别)

```
[AAPL] A5 AI合成评分: 0.545 (加权: 流动性=0.156, 基本面=0.144, 情绪=0.104, 动量=0.148)
```

#### 3. **信号生成周期日志** (INFO 级别)

```
[AAPL] ========== A5 信号生成周期 ==========
[AAPL] 综合因子分析: 流动性=0.625, 基本面=0.480, 情绪=0.520, 动量=0.590 | 复合得分=0.545 | 价格=$234.50, 成交量=52000000
[AAPL] ✅ 生成BUY信号: 复合得分=0.545 >= 0.55, 数量=42
```

#### 4. **信号执行日志** (INFO 级别)

```
[AAPL] ✅ A5信号执行成功: BUY 42 股 @ $234.50
[AAPL] ⏳ A5信号提交待确认: BUY 42 股 @ $234.50
[AAPL] ⚠️ A5信号执行失败 (REJECTED): BUY 42 股 @ $234.50 - Insufficient funds
```

#### 5. **过滤和调试日志** (DEBUG 级别)

```
[AAPL] A5流动性: 数据不足 (仅 15 条)
[AAPL] A5过滤: 价格 4.50 < 最小值 5.0
[AAPL] A5过滤: 成交量 250000 < 最小值 500000
[AAPL] 无BUY信号: 复合得分=0.42 < 0.55
[AAPL] 持有多头: 复合得分=0.50 > 0.35
```

#### 6. **周期统计日志** (INFO 级别)

```
[AAPL] 本周期 A5 生成 3 个信号
```

## 📈 查看日志方式

### 方式1: 实时查看控制台输出

```bash
python3 main.py -s a5
```

### 方式2: 查看日志文件

```bash
# 查看最新日志
tail -f logs/trading_system.log

# 搜索 A5 相关日志
grep "A5" logs/trading_system.log

# 搜索特定标的的 A5 日志
grep "\[AAPL\].*A5" logs/trading_system.log

# 查看 A5 生成的所有信号
grep "A5.*信号" logs/trading_system.log
```

### 方式3: 过滤特定级别

```bash
# 只看 INFO 级别（因子评分、信号、执行）
grep "INFO.*A5" logs/trading_system.log

# 只看警告和错误
grep "WARNING\|ERROR.*A5" logs/trading_system.log

# 看调试信息（DEBUG 级别，需要修改日志级别）
```

## ⚙️ 配置参数

在 `config.py` 的 `strategy_a5` 部分修改：

```python
'strategy_a5': {
    'min_confidence': 0.4,              # 最小信心度 (0-1)
    'min_price': 5.0,                   # 最小股价
    'min_volume': 500000,               # 最小日成交量
    'buy_threshold': 0.55,              # 买入复合得分阈值
    'sell_threshold': 0.45,             # 卖出阈值
    'exit_threshold': 0.35,             # 平仓阈值
    'lookback_period': 90,              # 基本面回溯天数
    'recent_period': 20,                # 最近期间天数
    'liquidity_weight': 0.25,           # 流动性权重
    'fundamental_weight': 0.30,         # 基本面权重
    'sentiment_weight': 0.20,           # 情绪权重
    'momentum_weight': 0.25,            # 动量权重
}
```

## 🔍 日志解读示例

### 示例1: 成功的买入信号

```log
[TSLA] ========== A5 信号生成周期 ==========
[TSLA] A5流动性评分: 0.720 (成交量比=2.10, 趋势=0.85, 一致性=0.50)
[TSLA] A5基本面评分: 0.580 (PE动量=0.60, 盈利动量=0.58, 股息信号=0.55)
[TSLA] A5情绪评分: 0.650 (看涨信号=0.75, 成交量突增=0.65, 动量=0.52)
[TSLA] A5动量评分: 0.620 (RSI=0.68, MACD=0.62, ROC=0.58, 趋势=0.62)
[TSLA] A5 AI合成评分: 0.612 (加权: 流动性=0.180, 基本面=0.174, 情绪=0.130, 动量=0.155)
[TSLA] 综合因子分析: 流动性=0.720, 基本面=0.580, 情绪=0.650, 动量=0.620 | 复合得分=0.612 | 价格=$454.50, 成交量=125000000
[TSLA] ✅ 生成BUY信号: 复合得分=0.612 >= 0.55, 数量=21
[TSLA] ✅ A5信号执行成功: BUY 21 股 @ $454.50
```

### 示例2: 过滤掉的信号（成交量不足）

```log
[IBM] A5过滤: 成交量 350000 < 最小值 500000
[IBM] 本周期 A5 无信号生成
```

### 示例3: 评分未达阈值

```log
[IBM] ========== A5 信号生成周期 ==========
[IBM] 综合因子分析: 流动性=0.420, 基本面=0.380, 情绪=0.410, 动量=0.390 | 复合得分=0.400 | 价格=$185.30, 成交量=28000000
[IBM] 无BUY信号: 复合得分=0.400 < 0.55
[IBM] 本周期 A5 无信号生成
```

## 🎯 最佳实践

1. **首次运行**: 使用 `test_a5_logging.py` 快速验证日志输出
2. **调整参数**: 根据市场条件调整各因子权重
3. **监控日志**: 实时查看信号生成和执行情况
4. **对标对比**: 与其他策略（A1-A4）的日志对比
5. **性能分析**: 收集 1-2 周数据后分析信号成功率

## 📞 问题排查

| 问题 | 原因 | 解决方案 |
|------|------|--------|
| 无 A5 日志 | 未启用 A5 策略 | 使用 `python3 main.py -s a5` 启动 |
| 日志中无因子分数 | 数据不足 | 等待足够数据加载 |
| 信号过多 | 阈值设置过低 | 提高 `buy_threshold`, 降低 `sell_threshold` |
| 信号过少 | 阈值设置过高 | 降低 `buy_threshold`, 提高 `sell_threshold` |
| 执行失败 | 账户资金不足 | 检查可用资金或降低风险率 |

---

**更新于**: 2025-12-06
**A5 版本**: 1.0 - 初始发布
